{
    "$schema": "https://schema.management.azure.com/schemas/2021-09-09/uiFormDefinition.schema.json",
    "view": {
        "kind": "Form",
        "properties": {
            "title": "Deploy Production Core DMS",
            "steps": [
                {
                    "name": "basics",
                    "label": "Basics",
                    "elements": [
                        {
                            "name": "resourceScope",
                            "type": "Microsoft.Common.ResourceScope",
                            "location": {
                                "resourceTypes": [
                                    "microsoft.network/virtualnetworks",
                                    "microsoft.network/networksecuritygroups",
                                    "microsoft.app/managedenvironments",
                                    "microsoft.app/containerapps",
                                    "microsoft.network/privateendpoints",
                                    "microsoft.dbforpostgresql/flexibleservers",
                                    "microsoft.resources/resourcegroups"
                                ]
                            }
                        },
                        {
                            "name": "name",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Name",
                            "subLabel": "",
                            "defaultValue": "",
                            "toolTip": "The base name of the services. Most services will be appended with a service name (i.e. -postgres).",
                            "constraints": {
                                "required": true,
                                "regex": "",
                                "validationMessage": "",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        }
                    ]
                },
                {
                    "name": "details",
                    "label": "Details",
                    "elements": [
                        
                        {
                            "name": "containerImageService",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Container Image Service",
                            "subLabel": "",
                            "defaultValue": "",
                            "toolTip": "The container image to use. See [OSDU Forum Production DMS Container Registry](https://community.opengroup.org/osdu/platform/domain-data-mgmt-services/production/core/dspdm-services/container_registry) for available images.",
                            "constraints": {
                                "required": true,
                                "regex": "",
                                "validationMessage": "",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "containerImageInit",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Container Image Init",
                            "subLabel": "",
                            "defaultValue": "",
                            "toolTip": "The container image to use for the init container. See [OSDU Forum Production DMS Container Registry](https://community.opengroup.org/osdu/platform/domain-data-mgmt-services/production/core/dspdm-services/container_registry) for available images.",
                            "constraints": {
                                "required": true,
                                "regex": "",
                                "validationMessage": "",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "modelDatabaseName",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Model Database Name",
                            "subLabel": "",
                            "defaultValue": "",
                            "toolTip": "The database to use for the model.",
                            "constraints": {
                                "required": true,
                                "regex": "",
                                "validationMessage": "",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "serviceDatabaseName",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Service Database Name",
                            "subLabel": "",
                            "defaultValue": "",
                            "toolTip": "The database to use for the service.",
                            "constraints": {
                                "required": true,
                                "regex": "",
                                "validationMessage": "",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "databaseUsername",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Database Username",
                            "subLabel": "",
                            "defaultValue": "",
                            "toolTip": "The username to use for the database.",
                            "constraints": {
                                "required": true,
                                "regex": "",
                                "validationMessage": "",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "databasePassword",
                            "type": "Microsoft.Common.PasswordBox",
                            "label": {
                                "password": "Database Password",
                                "confirmPassword": "Confirm password"
                            },
                            "defaultValue": "",
                            "toolTip": "The password to use for the database.",
                            "constraints": {
                                "required": true,
                                "regex": "",
                                "validationMessage": "",
                                "validations": []
                            },
                            "options": {
                                "hideConfirmation": true
                            },
                            "visible": true
                        },
                        {
                            "name": "vnet",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Vnet",
                            "subLabel": "",
                            "defaultValue": "",
                            "toolTip": "The virtual network to use for the service.",
                            "constraints": {
                                "required": true,
                                "regex": "",
                                "validationMessage": "",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "databaseSubnet",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Database Subnet",
                            "subLabel": "",
                            "defaultValue": "",
                            "toolTip": "The subnet to use for the database.",
                            "constraints": {
                                "required": true,
                                "regex": "",
                                "validationMessage": "",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "containerSubnet",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Container Subnet",
                            "subLabel": "",
                            "defaultValue": "",
                            "toolTip": "The subnet to use for the container.",
                            "constraints": {
                                "required": true,
                                "regex": "",
                                "validationMessage": "",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "workloadProfile",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Workload Profile",
                            "subLabel": "",
                            "defaultValue": "Consumption",
                            "toolTip": "The workload profile to use for the container app. Consumption uses the `Consumption` profile, while Premium uses the `D4` profile. [Learn more](https://learn.microsoft.com/en-us/azure/container-apps/workload-profiles-overview#profile-types).",
                            "constraints": {
                                "required": false,
                                "regex": "",
                                "validationMessage": "",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "osduEndpoint",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Osdu Endpoint",
                            "subLabel": "",
                            "defaultValue": "https://<your-adme-instance>.energy.azure.com/",
                            "toolTip": "The ADME endpoint to connect to.",
                            "constraints": {
                                "required": false,
                                "regex": "",
                                "validationMessage": "",
                                "validations": [
                                    {
                                        "isValid": "[or(or(empty(steps('basics').osduEndpoint),and(not(startsWith(steps('basics').osduEndpoint,'[[')),startsWith(steps('basics').osduEndpoint,'['),endsWith(steps('basics').osduEndpoint,']'),greater(indexOf(steps('basics').osduEndpoint,'('),-1),greater(indexOf(steps('basics').osduEndpoint,')'),-1))),greaterOrEquals(length(steps('basics').osduEndpoint),26))]",
                                        "message": "The value must have a length of at least 26."
                                    },
                                    {
                                        "isValid": "[or(or(empty(steps('basics').osduEndpoint),and(not(startsWith(steps('basics').osduEndpoint,'[[')),startsWith(steps('basics').osduEndpoint,'['),endsWith(steps('basics').osduEndpoint,']'),greater(indexOf(steps('basics').osduEndpoint,'('),-1),greater(indexOf(steps('basics').osduEndpoint,')'),-1))),lessOrEquals(length(steps('basics').osduEndpoint),41))]",
                                        "message": "The value must have a length of at most 41."
                                    }
                                ]
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "dataPartitionId",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Data Partition Id",
                            "subLabel": "",
                            "defaultValue": "data",
                            "toolTip": "The data partition ID to use.",
                            "constraints": {
                                "required": false,
                                "regex": "",
                                "validationMessage": "",
                                "validations": [
                                    {
                                        "isValid": "[or(or(empty(steps('basics').dataPartitionId),and(not(startsWith(steps('basics').dataPartitionId,'[[')),startsWith(steps('basics').dataPartitionId,'['),endsWith(steps('basics').dataPartitionId,']'),greater(indexOf(steps('basics').dataPartitionId,'('),-1),greater(indexOf(steps('basics').dataPartitionId,')'),-1))),greaterOrEquals(length(steps('basics').dataPartitionId),1))]",
                                        "message": "The value must have a length of at least 1."
                                    },
                                    {
                                        "isValid": "[or(or(empty(steps('basics').dataPartitionId),and(not(startsWith(steps('basics').dataPartitionId,'[[')),startsWith(steps('basics').dataPartitionId,'['),endsWith(steps('basics').dataPartitionId,']'),greater(indexOf(steps('basics').dataPartitionId,'('),-1),greater(indexOf(steps('basics').dataPartitionId,')'),-1))),lessOrEquals(length(steps('basics').dataPartitionId),31))]",
                                        "message": "The value must have a length of at most 31."
                                    }
                                ]
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "admeScope",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Adme Scope",
                            "subLabel": "",
                            "defaultValue": "",
                            "toolTip": "The ADME scope to use.",
                            "constraints": {
                                "required": true,
                                "regex": "",
                                "validationMessage": "",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "clientID",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Client ID",
                            "subLabel": "",
                            "defaultValue": "",
                            "toolTip": "The client ID to use for the service.",
                            "constraints": {
                                "required": true,
                                "regex": "",
                                "validationMessage": "",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "clientSecret",
                            "type": "Microsoft.Common.PasswordBox",
                            "label": {
                                "password": "Client Secret",
                                "confirmPassword": "Confirm password"
                            },
                            "defaultValue": "",
                            "toolTip": "The client secret to use for the service.",
                            "constraints": {
                                "required": true,
                                "regex": "",
                                "validationMessage": "",
                                "validations": []
                            },
                            "options": {
                                "hideConfirmation": true
                            },
                            "visible": true
                        },
                        {
                            "name": "privateEndpointEnabled",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Private Endpoint Enabled",
                            "subLabel": "",
                            "defaultValue": "false",
                            "toolTip": "Enable private network for the service. This will deploy a virtual network which all resources are joined to.",
                            "constraints": {
                                "required": false,
                                "allowedValues": [
                                    {
                                        "label": "true",
                                        "value": true
                                    },
                                    {
                                        "label": "false",
                                        "value": false
                                    }
                                ],
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "guid1",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Guid1",
                            "subLabel": "",
                            "defaultValue": "[[newGuid()]",
                            "toolTip": "A unique identifier.",
                            "constraints": {
                                "required": false,
                                "regex": "",
                                "validationMessage": "",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "guid2",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Guid2",
                            "subLabel": "",
                            "defaultValue": "[[newGuid()]",
                            "toolTip": "A unique identifier.",
                            "constraints": {
                                "required": false,
                                "regex": "",
                                "validationMessage": "",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        }
                    ]
                }
            ]
        },
        "outputs": {
            "kind": "ResourceGroup",
            "location": "[steps('basics').resourceScope.location.name]",
            "resourceGroupId": "[steps('basics').resourceScope.resourceGroup.id]",
            "parameters": {
                "name": "[steps('basics').name]",
                "containerImageService": "[steps('basics').containerImageService]",
                "containerImageInit": "[steps('basics').containerImageInit]",
                "modelDatabaseName": "[steps('basics').modelDatabaseName]",
                "serviceDatabaseName": "[steps('basics').serviceDatabaseName]",
                "databaseUsername": "[steps('basics').databaseUsername]",
                "databasePassword": "[steps('basics').databasePassword]",
                "vnet": "[steps('basics').vnet]",
                "databaseSubnet": "[steps('basics').databaseSubnet]",
                "containerSubnet": "[steps('basics').containerSubnet]",
                "workloadProfile": "[steps('basics').workloadProfile]",
                "osduEndpoint": "[steps('basics').osduEndpoint]",
                "dataPartitionId": "[steps('basics').dataPartitionId]",
                "admeScope": "[steps('basics').admeScope]",
                "clientID": "[steps('basics').clientID]",
                "clientSecret": "[steps('basics').clientSecret]",
                "privateEndpointEnabled": "[steps('basics').privateEndpointEnabled]",
                "guid1": "[steps('basics').guid1]",
                "guid2": "[steps('basics').guid2]"
            }
        }
    }
}