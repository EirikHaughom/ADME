{
    "$schema": "https://schema.management.azure.com/schemas/2021-09-09/uiFormDefinition.schema.json",
    "view": {
        "kind": "Form",
        "properties": {
            "title": "Deploy Schema Upgrade Tool",
            "steps": [
                {
                    "name": "basics",
                    "label": "Basics",
                    "elements": [
                        {
                            "name": "resourceScope",
                            "type": "Microsoft.Common.ResourceScope"
                        },
                        {
                            "name": "name",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Container App name",
                            "toolTip": "The name of the Container App",
                            "constraints": {
                                "required": true,
                                "minLength": 3,
                                "maxLength": 24
                            }
                        }
                    ]
                },
                {
                    "name": "settings",
                    "label": "Settings",
                    "elements": [
                        {
                            "name": "containerImage",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Container image",
                            "defaultValue": "community.opengroup.org:5555/osdu/platform/system/reference/schema-upgrade/schema-upgrade-v0-27-1:latest",
                            "toolTip": "The container image to use",
                            "constraints": {
                                "required": true
                            }
                        },
                        {
                            "name": "osduEndpoint",
                            "type": "Microsoft.Common.TextBox",
                            "label": "ADME endpoint",
                            "placeholder": "https://<your-adme-instance>.energy.azure.com/",
                            "toolTip": "The ADME endpoint to connect to",
                            "constraints": {
                                "required": true,
                                "minLength": 26,
                                "maxLength": 41
                            }
                        },
                        {
                            "name": "workloadProfile",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Workload profile",
                            "defaultValue": "Consumption",
                            "constraints": {
                                "required": true,
                                "allowedValues": [
                                    { "label": "Consumption", "value": "Consumption" },
                                    { "label": "Premium", "value": "Premium" }
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "networking",
                    "label": "Networking",
                    "elements": [
                        {
                            "name": "privateEndpointEnabled",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Use private network?",
                            "defaultValue": false,
                            "constraints": {
                                "allowedValues": [
                                    { "label": "No", "value": false },
                                    { "label": "Yes", "value": true }
                                ]
                            }
                        },
                        {
                            "name": "vnet",
                            "type": "Microsoft.Network.VirtualNetworkCombo",
                            "label": "Virtual Network",
                            "visible": "[equals(steps('networking').privateEndpointEnabled, true)]",
                            "scope": {
                                "subscriptionId": "[steps('basics').resourceScope.subscription.subscriptionId]",
                                "resourceGroupName": "[steps('basics').resourceScope.resourceGroup.name]",
                                "location": "[steps('basics').resourceScope.location.name]"
                            },
                            "options": { "hideExisting": false },
                            "defaultValue": { "addressPrefixSize": "/24" },
                            "constraints": { "minAddressPrefixSize": "/30" },
                            "subnets": {
                                "containerSubnet": {
                                    "label": "Container subnet",
                                    "defaultValue": { "name": "containerSubnet", "addressPrefixSize": "/24" },
                                    "constraints": { "minAddressPrefixSize": "/30", "minAddressCount": 2 }
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "tags",
                    "label": "Tags",
                    "elements": [
                        {
                            "name": "tags",
                            "type": "Microsoft.Common.TagsEditor",
                            "label": "Resource tags",
                            "toolTip": "Tags to apply to all resources"
                        }
                    ]
                }
            ]
        },
        "outputs": {
      "kind": "ResourceGroup",
      "location": "[steps('basics').resourceScope.location.name]",
      "resourceGroupId": "[steps('basics').resourceScope.resourceGroup.id]",
      "parameters": {
        "name": "[steps('basics').name]",
        "containerImage": "[steps('settings').containerImage]",
        "osduEndpoint": "[steps('settings').osduEndpoint]",
        "workloadProfile": "[steps('settings').workloadProfile]",
        "privateEndpointEnabled": "[steps('networking').privateEndpointEnabled]",
        "vnet": "[steps('networking').vnet]",
        "virtualNetworkNewOrExisting": "[steps('networking').vnet.newOrExisting]",
        "containerSubnet": "[steps('networking').vnet.subnets.containerSubnet]",
        "tags": "[steps('tags').tags]"
      }
    }
  }
}